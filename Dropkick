local Player = game.Players.LocalPlayer
local Character = Player.Character
local Root = Character:WaitForChild("HumanoidRootPart")
local Humanoid = Character:WaitForChild("Humanoid")

Player:SetAttribute("Run", false)

local function Cutscene()
	local Camera = workspace.CurrentCamera
	local Rig = game.ReplicatedStorage.Resources.CamLetterBox:Clone()
	Rig.Parent = workspace.Effects
	Rig.camerarootpart.CFrame = Root.CFrame
	Camera.CameraType = Enum.CameraType.Scriptable
	Camera.CFrame = Rig.camera.CFrame
	local Track = Rig.AnimationController:LoadAnimation(game.ReplicatedStorage.Resources.KJ.dropKickCam)
	Track:Play()
	local StartTime = tick()
	local Duration = 14
	
	repeat
		Camera.CFrame = Rig.camera.CFrame
		task.wait()
	until tick() - StartTime - Duration
	task.wait()
	Player.CameraMode = Enum.CameraMode.Classic
	Camera.CameraType = Enum.CameraType.Custom
	Camera.CameraSubject = Character:WaitForChild("Humanoid")
	Camera.FieldOfView = 75
	Camera.Focus = Character:WaitForChild("Head").CFrame
	Rig:Destroy()
end

local RunTrack = Humanoid:LoadAnimation(game.ReplicatedStorage.Resources.KJ.dropKick)
local HitTrack = Humanoid:LoadAnimation(game.ReplicatedStorage.Resources.KJ.dropKickHit)

local Step = "Startup"
spawn(function()
	if Humanoid.Health <= 0 then return end
	if not Character:FindFirstChild("movementFolder") then return end
	RunTrack:Play()
	Character:FindFirstChild("movementFolder").Value:SetAttribute("Speed", 0)
	task.wait(2.5, function()
		if RunTrack.IsPlaying then
			Player:SetAttribute("Run", true)
		end
	end)
end)

Humanoid.HealthChanged:Connect(function()
	if Step ~= "Hit" then
		RunTrack:Stop()
	end
end)
